<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<%- include('partials/includes/header') %>
<%- include('partials/includes/navbar') %>
<div class="container">
        
       
                <%- include('components/chat_side_bar') %>
        <div class="row">
                <div class="col-3">
                                <div class="row">
                                        <% if(items.length > 0){%>
                                                <% for(var i = 0, len = items.length; i < len; i++){%>
                                                <div class="card">
                                                                <ul class="nav">
                                                                        <li class="text-center"> 
                                                                                <div class="card-body"> 
                                                                                <img class="card-img" src="https://qpr2l7.pixelcrush.io/large/static1.chamonet.com%2Fimage_uploader%2Fphotos%2Fe5%2Flarge%2Falmost-time-to-put-away-the-skis-in-chamonix-chamonix-mont-blanc-valley.jpg?auth=41e199f01371394397152a3446ee7ae48879da30" alt="Card image">  
                                                                                <div class="card-img-overlay">
                                                                                <div class="text-center" style="margin-top:10%">
                                                                                        <img class="card-img border border-light" src="../public/profile_image/<%=items[i].user_profile_pic %>" alt="Card image"  style="width:150px; height:150px;border-radius: 50%">
                                                                                </div>

                                                                                </div>
                                                                                </div>
                                                                        
                                                                        <div class="card-body">
                                                                        <h5><%=items[i].user_firstname %> <%=items[i].user_lastname %> </h5>
                                                                        <hr>
                                                                        <div class="socail_media">
                                                                                <i class="fab fa-facebook"></i><i class="fab fa-instagram" style="margin-left:10px"></i><i class="fab fa-twitter" style="margin-left:10px"></i><i class="fab fa-pinterest" style="margin-left:10px"></i><i class="fab fa-linkedin" style="margin-left:10px"></i>
                                                                        </div>
                                                                        <hr>
                                                                        <div class="row">
                                                                                        <div class="col-4">
                                                                                                        <small><span class="countFollowers"></span></small><br />Followers
                                                                                                        
                                                                                        </div>
                                                                                        <div class="col-4">
                                                                                                        <small><span class="countFollowing"></span></small><br />Following
                                                                                        </div>
                                                                                        <div class="col-4">
                                                                                                        <small>100k</small><br /><i class="far fa-eye"></i>
                                                                                        </div>
                                                                                </div>
                                                                        </div>
                                                                        
                                                                        
                                                                        </li>
                                                                                
                                                                                
                                                                                
                                                                       
                                                                                
                                                                        
                                                                </ul>
                                                                
                                                                   
                                                        
                                                            
                                                        </div> 
                                                        <%}%>
                                                        <%}else{%>
                                                                <span>Need To Fix This</span>
                                                        <%}%>  
                                                 

                                </div>
                                <div class="row">
                                        <%if(items.length > 0){%>
                                                <%for(var i = 0, len = items.length; i < len; i++){%>
                                                <div class="card" style="background:#ffffff;margin-top:30px">
                                                                <div class="card about-user">
                                                                
                                                                
                                                        <div class="card-body">  
                                                                        <h4 class="card-title">Contact Me</h4>       
                                                                <div class="text-justify">
                                                                    <p class="card-text"><strong><i class="far fa-envelope"></i> </strong> <span class="m-l-15"><%=items[i].user_email %></span></p>
                                                                    <p class="card-text"><strong><i class="fas fa-link"></i> </strong><span class="m-l-15">www.facebook.com</span></p>
                                                                    <p class="card-text"><strong><i class="fas fa-comment-dots"></i> </strong><span class="m-l-15">Leave a message</span></p>
                                                                    <p class="card-text"><strong><i class="fas fa-map-marker-alt"></i> </strong> <span class="m-l-15">India,Maharashtra Mumbai</span></p>
                                                                </div>			
                                                                          
                                                        </div>
                                                </div>	                        
                                                </div>
                                                <%}%>
                                        <%}else{%>
                                                
                                        <%}%>
                                </div>

                                <div class="row">
                                                <div class="card" style="background:#ffffff;margin-top:30px">
                                                                <div class="card about-user">
                                                                         <div class="card-body">
                                                                          <div class="card-block">
                                                                               <h4 class="card-title info">About Me</h4>
                                                                               
                                                                               <p class="card-text">Life is too short. Don't waste it reading my status, come on follow me.</p>
                                                                   			
                                                                          </div>
                                                                         </div>
                                                                </div>	                        
                                                </div>
                                </div>
                        

                </div>

                <div class="col-9" >
                                
                            
                                       <!-- chart section -->

                                       <!-- Button trigger modal-->
                                       
                                        <!-- Modal Heat map on popup right view -->
                                       <!-- Central Modal Small -->
                                        <div class="modal fade" id="centralModalSm" style="width:400px; position:center" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                                        aria-hidden="true">

                                        <!-- Change class .modal-sm to change the size of the modal -->
                                        <div class="modal-dialog modal-sm" role="document">


                                        <div class="modal-content">
                                        <div class="modal-header">
                                       
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                        </button>
                                        </div>
                                        <div class="modal-body" id="event_heatmap_info">
                                       
                                        </div>
                                      
                                        </div>
                                        </div>
                                        </div>
                                        <!-- Central Modal Small -->
                                        
                                        <!-- Modal: modalCart -->

                                                <div class="card">
                                                                <div class="card" id="heap_map_chart"></div>
                                                                
                                                                <div class="card">
                                                                        
                                                                                <ul class="nav justify-content-center">
                                                                                                <li class="nav-item" style="margin: 5px">
                                                                                                        <div class="card">
                                                                                                                <div class="card-body">
                                                                                                                                <span class="total_upcoming_event_count"></span>
                                                                                                                                <small class="padding:10px">Upcoming</small>            
                                                                                                                </div>
                                                                                                        </div>
                                                                                                
                                                                                               
                                                                                                </li>
                                                                                                <li class="nav-item" style="margin: 5px">
                                                                                                                <div class="card">
                                                                                                                                <div class="card-body">
                                                                                                                                                <span class="total_active_event_count"></span>
                                                                                                                                                <small class="padding:10px">Active</small>            
                                                                                                                                </div>
                                                                                                                        </div> 
                                                                                                </li>
                                                                                                <li class="nav-item" style="margin: 5px">
                                                                                                                <div class="card">
                                                                                                                                <div class="card-body">
                                                                                                                                                <span class="total_past_event_count"></span>
                                                                                                                                                <small class="padding:10px">Previous</small>            
                                                                                                                                </div>
                                                                                                                        </div>     
                                                                                                </li>
                                                                                                <li class="nav-item" style="margin: 5px">
                                                                                                                <div class="card">
                                                                                                                                <div class="card-body">
                                                                                                                                                <span class="total_total_event_count"></span>
                                                                                                                                                <small class="padding:10px">Total Events</small>            
                                                                                                                                </div>
                                                                                                                </div>
                                                                                                </li>
                                                                                               
                                                                                               
                                                                                              
                                                                                              </ul>
                                                                        
                                                                </div>
                                                                 
                                                </div>

                                                

                                                   <!-- create posts -->
                                                <div class="card" style="margin-top:30px">
                                                                <div class="card-body">
                                                                
                                                                <% if(items.length > 0){%>
                                                                   <% for( var i = 0, len = items.length; i < len; i++){%>
                                                                        <% if (items[i].user_profile_pic)
                                                                        { %>
                                                                                <a href=""><img src="../public/profile_image/<%= items[i].user_profile_pic %>" alt="" class="rounded-circle border border-danger" style="width:50px; height:50px"></a>
                                                                                
                                                                        <%} else 
                                                                        {%>
                                                                                <a href=""><img src="../public/image/1.jpg" alt="" class="rounded-circle border border-danger" style="width:50px; height:50px"></a>
                                                                        <%}%>  
                                                                        <a href="event"><button class="btn btn-light" style="position: absolute;right:150px;">Create Event</button></a>
                                                                        <a href="#"><button class="btn btn-dark" style="position: absolute;right:5px;">Create Video</button></a>   
                                                                   <%}%>     
                                                                <%}%>

                                                   
                                                                
                                                                
                            
                                  
                                                                </div>
                                                </div>
                                               

                                                <!--------------------->

                                                <!-- Modal -->

                                                              <!-- Modal: modalQuickView -->
                                                              <div class="modal fade" id="modalQuickView" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                                                aria-hidden="true">
                                                                <div class="modal-dialog modal-lg" role="document">
                                                                  <div class="modal-content">
                                                                    <div class="modal-body">
                                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                                                                        aria-hidden="true">&times;</span></button>
                                                                      <div class="row" id="show_data">

                                                                      </div>
                                                                    </div>
                                                                  </div>
                                                                </div>
                                                              </div>
                                                <!--------------------------->




                                                <div class="card" style="margin-top:30px">
                                                                <% if(items.length > 0){ %>   
                                                                        <% for(var i = 0, len = items.length; i < len; i++){%>
                                                                        <% var post_data = items[i].Posts; %> 
                                                                
                                                                <h5 class="card-header"><span class="total_upcoming_event_count" style="margin-right:10px"></span>Upcoming Events</h5>
                                                                <div class="card-group" style="margin-right: 15px" id="owl-demo">  
                                                                                       
                
                                                                        
                                                                        <% for (var j = 0, len_1 = post_data.length; j < len_1; j++) {%> 
                                                                        
                                                                        <% if(post_data[j].event_start_date > onlyDate){%>

                                                                        <div class="card postfullview" data-onclickview="<%= post_data[j].event_id %>">
                                                                                    
                                                                        <div class="item"><img src="../public/image/<%=post_data[j].e_imagepath %>" alt="Owl Image" style="width: 400px; height:200px"></div> 
                                                                        <div class="card-footer bg-transparent border-success">
                                                                                        <ul class="nav">
                                                                                                <li class="nav-item">
                                                                                                        <span class="like" data-post="<%= post_data[j].event_id %>"><i class="fas fa-thumbs-up" style="cursor: pointer;">
                                                                                                                <span class="countLikes" id="countLikes<%= post_data[j].event_id %>" style="padding:2px"><%= post_data[j].Likes.length %></span></i></span>
                                                                                                </li>
                                                                                
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <span class="post_comment" id="<%= post_data[j].event_id %>"><i class="fas fa-comments" style="cursor: pointer;">
                                                                                                                <span class="countComments" style="padding:2px"><%= post_data[j].Comments.length %></span></i>
                                                                                                        </span>
                                                                                                </li>
                                                                                
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <i class="fas fa-share" style="cursor: pointer;"></i>
                                                                                                </li>
                                                    
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <span style="cursor: pointer;">Read More</span>
                                                                                                </li>
                                                    
                                                                                                <li class="nav-item" style="padding-left:20px">
                                                                                                        <i class="fas fa-ellipsis-v" style="cursor: pointer;"></i>
                                                                                                </li>
                                                                                        </ul>
                                                                                        </div>
                                                                        </div>
                                                                        <%}%>

                                                                        <%}%> 
                                                              
                                                 
                                        
                                                                       
                                                                        <%}%> 
                                                                        <%} else {%>
                                                                                <span>No Upcoming events yet</span>
                                                                        <%}%>    
                                                                </div>
                                                </div>

                                                <!-- active events -->

                                                <div class="card" style="margin-top:30px">
                                                                <% if(items.length > 0){ %>   
                                                                        <% for(var i = 0, len = items.length; i < len; i++){%>
                                                                        <% var post_data = items[i].Posts; %> 
                                                                        <h5 class="card-header"><span class="total_active_event_count" style="margin-right:10px"></span>Active Events</h5>
                                                                <div class="card-group" style="margin-right: 15px" id="owl-demo_3">  
                                                                                       
                
                                                                        
                                                                        <% for (var j = 0, len_1 = post_data.length; j < len_1; j++) {%> 
                                                                        
                                                                        <% if(post_data[j].event_start_date === onlyDate){%>

                                                                        <div class="card postfullview" data-onclickview="<%= post_data[j].event_id %>">
                                                                                    
                                                                        <div class="item"><img src="../public/image/<%=post_data[j].e_imagepath %>" alt="Owl Image" style="width: 400px; height:200px"></div> 
                                                                        <div class="card-footer bg-transparent border-success">
                                                                                        <ul class="nav">
                                                                                                <li class="nav-item">
                                                                                                        <span class="like" data-post="<%= post_data[j].event_id %>"><i class="fas fa-thumbs-up" style="cursor: pointer;">
                                                                                                                <span class="countLikes" id="countLikes<%= post_data[j].event_id %>" style="padding:2px"><%= post_data[j].Likes.length %></span></i></span>
                                                                                                </li>
                                                                                
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <span class="post_comment" id="<%= post_data[j].event_id %>"><i class="fas fa-comments" style="cursor: pointer;">
                                                                                                                <span class="countComments" style="padding:2px"><%= post_data[j].Comments.length %></span></i>
                                                                                                        </span>
                                                                                                </li>
                                                                                
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <i class="fas fa-share" style="cursor: pointer;"></i>
                                                                                                </li>
                                                    
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <span style="cursor: pointer;">Read More</span>
                                                                                                </li>
                                                    
                                                                                                <li class="nav-item" style="padding-left:20px">
                                                                                                        <i class="fas fa-ellipsis-v" style="cursor: pointer;"></i>
                                                                                                </li>
                                                                                        </ul>
                                                                                        </div>
                                                                        </div>
                                                                        <%}%>

                                                                        <%}%> 
                                                              
                                                 
                                        
                                                                       
                                                                        <%}%> 
                                                                        <%} else {%>
                                                                                <span>No Upcoming events yet</span>
                                                                        <%}%>    
                                                                </div>
                                                </div>



                                                <!-- Past Events -->

                                                <div class="card" style="margin-top:30px">
                                                                <% if(items.length > 0){ %>   
                                                                        <% for(var i = 0, len = items.length; i < len; i++){%>
                                                                        <% var post_data = items[i].Posts; %> 
                                                                        <h5 class="card-header"> <span class="total_past_event_count" style="margin-right:10px"></span>Past Events</h5>
                                                                <div class="card-group" style="margin-right: 15px" id="owl-demo_2">  
                                                                                       
                
                                                                        
                                                                        <% for (var j = 0, len_1 = post_data.length; j < len_1; j++) {%> 
                                                                        
                                                                        <% if(post_data[j].event_start_date < onlyDate){%>

                                                                        <div class="card postfullview" data-onclickview="<%= post_data[j].event_id %>" style="width: 400px;">
                                                                                    
                                                                        <div class="item"><img src="../public/image/<%=post_data[j].e_imagepath %>" alt="Owl Image" style="width: 400px; height:200px"></div> 
                                                                        <div class="card-footer bg-transparent border-success">
                                                                                        <ul class="nav">
                                                                                                <li class="nav-item">
                                                                                                        <span class="like" data-post="<%= post_data[j].event_id %>"><i class="fas fa-thumbs-up" style="cursor: pointer;">
                                                                                                                <span class="countLikes" id="countLikes<%= post_data[j].event_id %>" style="padding:2px"><%= post_data[j].Likes.length %></span></i></span>
                                                                                                </li>
                                                                                
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <span class="post_comment" id="<%= post_data[j].event_id %>"><i class="fas fa-comments" style="cursor: pointer;">
                                                                                                                <span class="countComments" style="padding:2px"><%= post_data[j].Comments.length %></span></i>
                                                                                                        </span>
                                                                                                </li>
                                                                                
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <i class="fas fa-share" style="cursor: pointer;"></i>
                                                                                                </li>
                                                    
                                                                                                <li class="nav-item" style="padding-left: 10px">
                                                                                                        <span style="cursor: pointer;">Read More</span>
                                                                                                </li>
                                                    
                                                                                                <li class="nav-item" style="padding-left:20px">
                                                                                                        <i class="fas fa-ellipsis-v" style="cursor: pointer;"></i>
                                                                                                </li>
                                                                                        </ul>
                                                                                        </div>
                                                                        </div>
                                                                        <%}%>

                                                                        <%}%> 
                                                              
                                                 
                                        
                                                                       
                                                                        <%}%> 
                                                                        <%} else {%>
                                                                                <span>No Upcoming events yet</span>
                                                                        <%}%>    
                                                                </div>
                                                </div>

                                     
                        
                </div>
                
        </div>

</div>


<script>

$(document).ready(function() 
{
        // I am following
        countFollowing()
        function countFollowing()
        {

                $.ajax(
                                {
                                        url:  '/profile/countFollowing',
                                        type: 'get',
                                        success : function(response)
                                        {    
                                                if(response !="")
                                                {
                                                        //alert(JSON.stringify(response.length))
                                                        $('.countFollowing').html(response.length)
                                                        
                                                }else{
                                                        alert("upcomingtotal events count null")
                                                }
                                        },
                                        error : function()
                                        {
                                                alert('error from server');
                                        }
                                }
                        );
        }

        // my followers
        countFollowers()
        function countFollowers()
        {

                $.ajax(
                                {
                                        url:  '/profile/countFollowers',
                                        type: 'get',
                                        success : function(response)
                                        {    
                                                if(response !="")
                                                {
                                                        //alert(JSON.stringify(response.length))
                                                        $('.countFollowers').html(response.length)
                                                        
                                                }else{
                                                        alert("upcomingtotal events count null")
                                                }
                                        },
                                        error : function()
                                        {
                                                alert('error from server');
                                        }
                                }
                        );
        }


        // upcoming events counts
        totalUpcomingEvents()
        function totalUpcomingEvents()
        {

                $.ajax(
                                {
                                        url:  '/profile/totalUpcomingEvents',
                                        type: 'get',
                                        success : function(response)
                                        {    
                                                if(response !="")
                                                {
                                                        $('.total_upcoming_event_count').html(response.count)
                                                        
                                                }else{
                                                        alert("upcomingtotal events count null")
                                                }
                                        },
                                        error : function()
                                        {
                                                alert('error from server');
                                        }
                                }
                        );
        }

        // active events count
        totalActiveEvents()
        function totalActiveEvents()
        {

                $.ajax(
                                {
                                        url:  '/profile/totalActiveEvents',
                                        type: 'get',
                                        success : function(response)
                                        {    
                                                if(response !="")
                                                {
                                                        $('.total_active_event_count').html(response.count)
                                                        
                                                }else{
                                                        alert("upcomingtotal events count null")
                                                }
                                        },
                                        error : function()
                                        {
                                                alert('error from server');
                                        }
                                }
                        );
        }

        // past events count
        totalPastEvents()
        function totalPastEvents()
        {

                $.ajax(
                                {
                                        url:  '/profile/totalPastEvents',
                                        type: 'get',
                                        success : function(response)
                                        {    
                                                if(response !="")
                                                {
                                                        $('.total_past_event_count').html(response.count)
                                                        
                                                }else{
                                                        alert("upcomingtotal events count null")
                                                }
                                        },
                                        error : function()
                                        {
                                                alert('error from server');
                                        }
                                }
                        );
        }

        // total events count
         // past events count
         totaltotalEvents()
        function totaltotalEvents()
        {

                $.ajax(
                                {
                                        url:  '/profile/totaltotalEvents',
                                        type: 'get',
                                        success : function(response)
                                        {    
                                                if(response !="")
                                                {
                                                        $('.total_total_event_count').html(response.count)
                                                        
                                                }else{
                                                        alert("upcomingtotal events count null")
                                                }
                                        },
                                        error : function()
                                        {
                                                alert('error from server');
                                        }
                                }
                        );
        }

        $("#owl-demo").owlCarousel(
        {

                autoPlay: 3000, //Set AutoPlay to 3 seconds
                touchDrag:true,
                items : 3,
                dots:true,
                autoplayHoverPause:true,
                animateOut:true,
                itemsDesktop : [1199,3],
                itemsDesktopSmall : [979,3]

        });

        $("#owl-demo_2").owlCarousel(
        {

                autoPlay: 3000, //Set AutoPlay to 3 seconds
                touchDrag:true,
                items : 3,
                dots:true,
                autoplayHoverPause:true,
                animateOut:true,
                itemsDesktop : [1199,3],
                itemsDesktopSmall : [979,3]

        });

        $("#owl-demo_3").owlCarousel(
        {

                autoPlay: 3000, //Set AutoPlay to 3 seconds
                touchDrag:true,
                items : 3,
                dots:true,
                autoplayHoverPause:true,
                animateOut:true,
                itemsDesktop : [1199,3],
                itemsDesktopSmall : [979,3]

        });
  

                // when user likes the post then it increaments by one and update the database and reflects the likes on posts
                $(document).on('click', '.like', function(events)
                {
                
                        events.preventDefault();
                        events.stopPropagation();
                        var postId = $(this).attr('data-post');
                        var postId = parseInt(postId,10)

                        $.ajax(
                                {
                                        type: 'POST',
                                        url:  '/posts/like/' + $(this).attr('data-post'),
                                        contentType: "application/json", 
                
                                        success : function(response)
                                        {
                                                
                                                if(response == false)
                                                {
                                                        alert("You have already liked this post")
                                                }
                                                else 
                                                {
                                                        $('#countLikes'+postId).html(response.count);
                                                }
                                                        
                                        
                                        },
                                        error : function()
                                        {
                                                alert('error from server');
                                        }
                                }
                        );
                })// like post ends 

                function modal_view_event_details(event_id)
                {
                        var $chat_history= document.getElementById("show_data");
                        $chat_history.innerHTML = "";
                        var innerHTML = ''
                        $.ajax(
                                {
                                        url:  '/profile/modeldata', 
                                        type: 'POST',
                                        data:{event_id:event_id},

                
                                        success : function(response)
                                        {
                                                if(response !="")
                                                {

                                                        for(var i=0, len = response.event_details.length; i < len; i++)
                                                        {


                                                        innerHTML = `<div class="col-7" style="padding-left:50px;padding-top:20px"><div class="row">
                                                                        <div class="d-flex bd-highlight">`;
                                                                                if (response.user[i].user_profile_pic) 
                                                                                {
                                                                                        innerHTML += ` <div class="img_cont"> 
                                                                                        <img src="../public/profile_image/${response.user[i].user_profile_pic}" class="rounded-circle user_img"> 
                                                                                        </div> `
                                                                                } 
                                                                                else 
                                                                                {
                                                                                        innerHTML += ` <div class="img_cont"><img src="../public/profile_image/icon.jpg" class="rounded-circle user_img"></div> `
                                                                                }
                                                                innerHTML += ` <div class="user_info viewclick" data-view="${response.user[i].user_id}">${response.user[i].user_firstname} ${response.user[i].user_lastname}<br/>
                                                                                        <small><i class="far fa-clock"></i> 2 hrs ago</small><br/>
                                                                                        <small><a href="http://maps.google.com/?q=${response.event_details[i].event_latitude},${response.event_details[i].event_logitude}"><i class="fas fa-map-marker-alt"></i> Map</a></small>
                                                                                        <small style="padding-left:10px" id="show_location"></small>
                                                                                </div> 
                                                                        </div></div>

                                                                        <div class="row">
                                                                                        <div class="title">
                                                                                      <h5><span style="padding-left:20px" id="show_title">${response.event_details[i].event_message}</span></h5>
                                                                                </div>
                                                                                        <div class="container" style="margin-left:20px;margin-right:20px;margin-top:5px">
                               
                                                                                                <p>${response.event_details[i].event_description}<span id="dots">...</span><span id="more" style="display: none;">${response.event_details[i].event_read_more_option}</span>
                                                                                                <span data-btn_hide_show="${response.event_details[i].event_id}" class="hide_show" id="myBtn" style="cursor: pointer;color:cornflowerblue">Read more</span>
                                                                                                </p>
                                                                                        </div>
                                                                        </div>

                                                                        <ul class="nav">
                                                                                <li>
                                                                                        <a href="/post/${response.event_details[i].event_id}">
                                                                                        <img src="../public/image/${response.event_details[i].e_imagepath}" alt="error check >" class="img-fluid">
                                                                                        </a>
                                                                                
                                                                                </li>
                                                                        </ul>`;

                                          innerHTML += `<div class="container">
                                                                <div class="row">
                                                                        <div class="col-md-6 like" style="padding-top:10px" data-post="${response.event_details[i].event_id}">
                                                                                <a href=""><i class="fas fa-thumbs-up"></i></a>
                                       
                                                                                <span class="countLikes" id="countLikes${response.event_details[i].event_id}" style="cursor: pointer;"> ${response.event_details[i].Likes.length} Like</span>
                                
                                                                        </div>`;

                                                  innerHTML += `        <div class="col-md-4 post_comment" id="${response.event_details[i].event_id}" style="padding-top:10px">
                                                                                <i class="fas fa-comments" style="cursor: pointer;"></i>
                                                                                <span class="countComments" style="cursor: pointer;"> ${response.event_details[i].Comments.length} comments</span>
                                                                        
                                                                        </div>

                                                                        <div class="col-md-2" style="padding-top:10px">
                                                                                        <i class="fas fa-share"></i>
                                                                                        <span>share</span>
                                                                        
                                                                        </div>

                                                                </div>
                                                        </div>

                                                                </div>`;
                                                                var comments_data = response.event_details[i].Comments.length;
                                                                //alert(comments_data)
                                                                innerHTML += `<div class="col-5">`;
                                                                        
                                                                        
                                                                for(var j=0, len_comment = comments_data; j < len_comment; j++)
                                                                {
                                                                        innerHTML += `<div class="row"><div class="col-1"><a href=""><img class="rounded-circle" src="../public/profile_image/${response.event_details[i].Comments[j].User.user_profile_pic}" alt="error" class="rounded-circle border border-danger" style="width:40px; height:40px"></a></div><div class="col-11"><p>${response.event_details[i].Comments[j].comment} <br/><small>${response.event_details[i].Comments[j].createdAt}</small></p></div></div><hr>`;

                                               

                                                                //alert(response.event_details[i].Comments[j].comment_id);
                                                                
                                                                //alert(response.event_details[i].Comments[j].User.user_firstname);
                                                                }

                                                                innerHTML += ` 
                                                                
                                                                <div class="container">
                                                                                        <div class="row">`;
                                                                                                
                                                                                                if(response.user[i].user_profile_pic)
                                                                                                {
                                                                                                        innerHTML += `<div class="col-md-2" style="padding-top:10px">
                                                                                                                        <a href=""><img class="rounded-circle" src="../public/profile_image/${response.user[i].user_profile_pic}" alt="error" class="rounded-circle border border-danger" style="width:40px; height:40px"></a>
                                                                                                                </div>`
                                                                                                }
                                                                                                else 
                                                                                                { 
                                                                                                        innerHTML += `<div class="col-md-2" style="padding-top:10px">
                                                                                                                        <a href=""><img class="rounded-circle" src="../public/profile_image/icon.jpg" alt="error" class="rounded-circle border border-danger" style="width:40px; height:40px"></a>
                                                                                                                </div>`
                                                                                                }
                                                                                                
                                                                                                innerHTML += `  <div class="col-md-7">
                                                                                                                        <div class="form-group" id="comment_form${response.event_details[i].event_id}">
                                                                                                                                <input class="form-control" name="comment" type="text" placeholder="Your comments" id="comment${response.event_details[i].event_id}"/>
                                                                                                                        </div>
                                                                                                                </div>

                                                                                                                <div class="col-md-3" style="padding-top:10px">
                                                                                                                        <button type="button" data-po="${response.event_details[i].event_id}" name="submit_comment" class="btn btn-default submit_comment">comment</button>
                                                                                                                </div>
                                                                                        </div>
                                                                                        

                                                                                        <div class="container" id="old_comment${response.event_details[i].event_id}">
                                                                                                

                                                                                        </div>
                                                                                                
                                                                                                
                                                                                        

                                                                                </div>
                                                                </div>`;
                                                                $chat_history.innerHTML = innerHTML;    
                                                                $('#modalQuickView').modal('show');

                                                        }
                                                }
                                                else{
                                                        alert("data null from modeldata")
                                                }

                                                
                                                
                                                // innerHTML = `<div class="col-8><div class="card"><img src="../public/image/1.jpg" class="rounded-circle user_img"> </div></div>`;
                                                // innerHTML += `<div class="col-4"> <img src="../public/image/9.jpg"></div>`;
                                                // $chat_history.innerHTML = innerHTML;
                                                // $('#modalQuickView').modal('show');
                                        },
                                        error:function(jqXHR, textStatus, errorThrown)
                        {
                                console.log('jqXHR:');
                                console.log(jqXHR);
                                console.log('textStatus:');
                                console.log(textStatus);
                                console.log('errorThrown:');
                                console.log(errorThrown);
                                alert(errorThrown);
                        }
                                }
                        );
                }
                
                $(document).on('click','.postfullview',function(events)
                {
        
                        events.preventDefault();
                        events.stopPropagation();
                        var event_id =$(this).data('onclickview'); 
                        modal_view_event_details(event_id);


                })
    requestData(); // calling function on page load
    function requestData()
    {
        $.ajax(
        {
            url: '/profile/heap_map_data',
            type: 'GET',
            success: function(response) 
            {
    
                var chart_data = [];
                var data = 1;
                var dataExists;
                
                var k = 0;
                for(var i = 0, len = response.length; i < len; i++)
                {
                    date_value = response[i].event_start_date;
                    var d = new Date(date_value);   
                    var year = d.getFullYear();
                    var month = d.getMonth();
                    var day = d.getDay();
                    var actualDay = day -1;
                   // check 1st in chart data, weather data exists or not
                   // if exits then increatment by 1
                   // not then put 1
                    
                    chart_data.push([month,actualDay,data]);
                }
                //alert(chart_data[1]);
                console.log(chart_data[1]);
                console.log("chart_data ==",chart_data);
                

                Highcharts.chart('heap_map_chart', 
                {colors: ['#058DC7', '#50B432', '#ED561B', '#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4'],

                        chart: {
                            type: 'heatmap',
                            marginTop: 40,
                            marginBottom: 80,
                        
                            backgroundColor: 
                            {
                                        linearGradient: [400, 0, 400, 400],
                                        stops: [
                                                [0, 'rgb(96, 96, 96)'],
                                                [1, 'rgb(16, 16, 16)']
                                        ]
                           },
                        borderWidth: 0,
                        
                        plotBackgroundColor: null,
                        plotShadow: false,
                        plotBorderWidth: 0
                            
                        },


                        title: {
                                style: { 
			color: '#FFF',
			font: '16px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
		},
                            text: 'Project Details'
                        },

                        xAxis: {

                                lineColor: '#999',
                                tickColor: '#999',
                                labels: 
                                {
                                        style: 
                                        {
                                                color: '#999',
                                                fontWeight: 'bold'
                                        }
                                },
                                title: 
                                {
                                        style: 
                                        {
                                                color: '#AAA',
                                                font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
                                        }				
                                },
                            categories: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']
                        },

                        yAxis: {

                                lineColor: '#999',
                                tickColor: '#999',
                                labels: 
                                {
                                        style: 
                                        {
                                                color: '#999',
                                                fontWeight: 'bold'
                                        }
                                },
                                title: 
                                {
                                        style: 
                                        {
                                                color: '#AAA',
                                                font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
                                        }				
                                },
                                
                            categories: ['Mon','Tue','Wed','Thur','Fri','Sat','Sun'],
                            title: null
                        },

                        

                        colorAxis: {
                            min: 2,
                            minColor: '#ECF0F1',
                            maxColor: Highcharts.getOptions().colors[0]
                        },

                        legend: {
                            align: 'right',
                            layout: 'vertical',
                            margin: 0,
                            verticalAlign: 'top',
                            y: 25,
                            symbolHeight: 280
                        },

                        tooltip: {
                                backgroundColor: {
			linearGradient: [0, 0, 0, 50],
			stops: [
				[0, 'rgba(96, 96, 96, .8)'],
				[1, 'rgba(16, 16, 16, .8)']
			]
		},
		borderWidth: 0,
		style: {
			color: '#FFF'
		},
                            formatter: function () 
                            {
                                return  + this.point.value + ' <b> project was uploaded on ' + this.series.xAxis.categories[this.point.x] + ' date, 2019' + '<br /> click to view more' ;
                            }
                        },

                        plotOptions: 
                        {
                                series: 
                                {
                                        color: '#212F3D',
                                    cursor: 'pointer',
                                    point: 
                                    {
                                        events: 
                                        {
                                            click: function () 
                                            {

                                                var year = 2019;
                                                var month = this.x;
                                                var y_axis_day = this.y;

                                                $.ajax(
                                                    {
                                                        url: '/profile/heap_map_event_details',
                                                        type: "POST",
                                                        data: {year:year,month:month},
                                                        success: function (response) 
                                                        {
                                                                
                                                                var $message_list= document.getElementById("event_heatmap_info");
                                                                $message_list.innerHTML = '';
                                                                for(var i = 0, len = response.length; i < len; i++)
                                                                {

                                                                    var date = new Date(response[i].event_start_date);   
                                                                    var day = date.getDay();
                                                                    var actualDay = day -1;
                                                                    actualDay = Number(actualDay)
                                                                    
                                                                    if(y_axis_day == actualDay)
                                                                    {
                                                                       $message_list.innerHTML = $message_list.innerHTML + `<div class="card" ><li class="list-group-item link-class" style="cursor: pointer;"><span class="postfullview" data-onclickview="${response[i].event_id}"</span> <div class="d-flex bd-highlight"> <div class="img_cont"><img src="../public/image/${response[i].e_imagepath}" class="rounded-circle user_img"></div><div class="user_info">${response[i].event_message}<br/><small style="color:#F44336"><strong>${response[i].event_start_date}</strong></small><br/><small>Last seen <small>${response[i].event_end_date}</small></small></div> </div> </li></div>`;
                                                                        $('#centralModalSm').modal('show')
                                                                        }
                                                                    
                                                                    
                                                                   
                                                                    
                                                                }
                                                                
                                                        },
                                                        error : function(jqXHR, textStatus, errorThrown)
                                                        {
                                                            console.log('jqXHR:');
                                                            console.log(jqXHR);
                                                            console.log('textStatus:');
                                                            console.log(textStatus);
                                                            console.log('errorThrown:');
                                                            console.log(errorThrown);
                                                            alert(errorThrown);                            
                                                        } 
                                                    });

                                            }
                                        }
                                    }
                                }
                            },

                        series: [
                            {

                            data: chart_data,
                            
                            lineColor: '#999',
                                tickColor: '#999',
                            dataLabels: {
                                enabled: true,
                                color: '#999'
                            }
                        }]

                }); 
                

            },
            error : function(jqXHR, textStatus, errorThrown)
            {
                console.log('jqXHR:');
                console.log(jqXHR);
                console.log('textStatus:');
                console.log(textStatus);
                console.log('errorThrown:');
                console.log(errorThrown);
                alert(errorThrown);
            } 
        
        });
    }



        // change profile image
        $("#form_data").submit(function(e)
        {	 
                e.preventDefault();
                var formData = new FormData($(this)[0]);
                alert(formData);
                $.ajax({
                url: '/profile/image/' + $(this).attr('data-user_id'),
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) 
                {
                        if(response.length > 0)
                        {
                                for(var i= 0; i< response.length; i++)
                                {
                                        var imagepath = response[i].user_profile_pic
                                        $('#profile_image').attr('src', "../public/profile_image/"+imagepath);
                                }
                        }
                },
                error : function(jqXHR, textStatus, errorThrown)
                {
                                                console.log('jqXHR:');
                                                console.log(jqXHR);
                                                console.log('textStatus:');
                                                console.log(textStatus);
                                                console.log('errorThrown:');
                                                console.log(errorThrown);
                                                alert(errorThrown);
                } 
                });
                return false;
        });



});

        //updating user data .....
        var $hide_about_me = $('.hide-about-me') 
        var $save_user_data_btn = $('.save-user-data-btn'); 
        var $show_data = $('.collapse');              
        $('.about-me').on('click', function(events)
        {
                $hide_about_me.hide(400);
                //alert($("#user_full_name").html())
                $('input.fullname').val($("#user_full_name").html());
                $('input.profession').val($("#user_profession").html());
                $('.cancel-edit-btn').on('click', function(events)
                {
                        $hide_about_me.show(400);
                })
                $save_user_data_btn.on('click',function(events)
                {
                        var user_id = $(this).attr('data-user_id')
                        //alert(user_id);
                        var fullname = $('input.fullname').val()
                        var data = {
                                        name: fullname
                        }
                        //alert(fullname)
                        $.ajax(
                                {
                                       type: 'PUT',
                                       url: '/profile/updatauserdata/' + $(this).attr('data-user_id'),
                                       contentType: "application/json",
                                       data: JSON.stringify(data),
                                       success: function(user)
                                       {
                                       
                                         user.forEach(function(item, index)
                                        {
                                                //alert(item.user_lastname)
                                                $show_data.html(item.user_lastname)
                                        })
                                            
                                               
                                               
                                       },
                                       error: function(jqXHR, textStatus, errorThrown)
                                       {
                                                console.log('jqXHR:');
                                                console.log(jqXHR);
                                                console.log('textStatus:');
                                                console.log(textStatus);
                                                console.log('errorThrown:');
                                                console.log(errorThrown);
                                                alert(errorThrown);
                                       } 
                                }
                        )
                }) 
                

       })

</script>